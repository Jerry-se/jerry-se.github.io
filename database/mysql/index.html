<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Jerry">
        <link rel="canonical" href="https://jerry-se.github.io/database/mysql/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>MySql - Jerry's blog</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../css/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/django.min.js"></script>
        <script>hljs.highlightAll();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-274394082"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', "G-274394082");
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Jerry's blog</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../markdown/" class="nav-link">Markdown</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">C/C++</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../cplusplus/lambda/" class="dropdown-item">Lambda</a>
</li>
                                    
<li>
    <a href="../../cplusplus/questions/" class="dropdown-item">Questions</a>
</li>
                                    
<li>
    <a href="../../cplusplus/bit_xor/" class="dropdown-item">Bit Xor</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Go</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../go/go/" class="dropdown-item">Go tutorial</a>
</li>
                                    
<li>
    <a href="../../go/install/" class="dropdown-item">Install</a>
</li>
                                    
<li>
    <a href="../../go/getting_started/" class="dropdown-item">Getting started</a>
</li>
                                    
<li>
    <a href="../../go/create_module/" class="dropdown-item">Create module</a>
</li>
                                    
<li>
    <a href="../../go/workspaces/" class="dropdown-item">Workspaces</a>
</li>
                                    
<li>
    <a href="../../go/web_service_gin/" class="dropdown-item">Web service gin</a>
</li>
                                    
<li>
    <a href="../../go/generics/" class="dropdown-item">Generics</a>
</li>
                                    
<li>
    <a href="../../go/writing_web_app/" class="dropdown-item">Writing Web app</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Tool</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../git/git/" class="dropdown-item">Git</a>
</li>
                                    
<li>
    <a href="../../git/git_lfs/" class="dropdown-item">Git LFS</a>
</li>
                                    
<li>
    <a href="../../git/gitea/" class="dropdown-item">Gitea</a>
</li>
                                    
<li>
    <a href="../../tool/frp/" class="dropdown-item">Frp</a>
</li>
                                    
<li>
    <a href="../../tool/v2ray/" class="dropdown-item">V2Ray</a>
</li>
                                    
<li>
    <a href="../../tool/activation_keys/" class="dropdown-item">Activation</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Python</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../python/build_blogs_with_pelican/" class="dropdown-item">Pelican</a>
</li>
                                    
<li>
    <a href="../../python/mkdocs/" class="dropdown-item">MkDocs</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Linux 开发</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../linux_development/docker/" class="dropdown-item">docker</a>
</li>
                                    
<li>
    <a href="../../linux_development/coredump/" class="dropdown-item">coredump</a>
</li>
                                    
<li>
    <a href="../../linux_development/ipmi/" class="dropdown-item">ipmi</a>
</li>
                                    
<li>
    <a href="../../linux_development/make_deb_package/" class="dropdown-item">制作 deb 安装包</a>
</li>
                                    
<li>
    <a href="../../linux_development/samba/" class="dropdown-item">Samba</a>
</li>
                                    
<li>
    <a href="../../linux_development/scsi/" class="dropdown-item">SCSI</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Windows 开发</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../windows_development/character_encoding/" class="dropdown-item">字符编码</a>
</li>
                                    
<li>
    <a href="../../windows_development/autostart/" class="dropdown-item">开机启动</a>
</li>
                                    
<li>
    <a href="../../windows_development/automatic_power_up/" class="dropdown-item">自动开机</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../../sitemap/" class="nav-link">Index</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#mysql" class="nav-link">MySql</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#install" class="nav-link">安装</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#mysql-client-command" class="nav-link">控制台命令</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#connectorc" class="nav-link">Connector/C++</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="3"><a href="#prepare-data" class="nav-link">准备数据</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#legacy-jdbc-api" class="nav-link">legacy JDBC API</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#x-devapi" class="nav-link">X DevAPI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#references" class="nav-link">参考资料</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="mysql">MySql<a class="headerlink" href="#mysql" title="Permanent link"></a></h1>
<h2 id="install">安装<a class="headerlink" href="#install" title="Permanent link"></a></h2>
<p><a href="https://dev.mysql.com/downloads/">MySQL Community Downloads</a></p>
<p>Ubuntu 系统若要安装最新版的 MySQL，需要先从官网下载 APT 配置，安装配置包，更新软件源，最后使用以下命令安装 MySQL Server:</p>
<pre><code class="language-shell">sudo apt install mysql-server
sudo systemctl start mysql.service
systemctl status mysql.service
</code></pre>
<p><code>/etc/mysql/conf.d/mysql.cnf</code> 中的默认配置。</p>
<pre><code>[mysqld]
pid-file        = /var/run/mysqld/mysqld.pid
socket          = /var/run/mysqld/mysqld.sock
datadir         = /var/lib/mysql
log-error       = /var/log/mysql/error.log
</code></pre>
<p>卸载清理 MySQL:</p>
<pre><code class="language-shell">sudo apt purge mysql-*
sudo rm -rf /etc/mysql/ /var/lib/mysql
sudo apt autoremove
sudo apt autoclean
</code></pre>
<p>参考博客: <a href="https://blog.csdn.net/weixin_44129085/article/details/104481986">https://blog.csdn.net/weixin_44129085/article/details/104481986</a></p>
<h2 id="mysql-client-command">控制台命令<a class="headerlink" href="#mysql-client-command" title="Permanent link"></a></h2>
<p>登录 MysQL 数据库:</p>
<pre><code>mysql -u root -p
mysql -h 127.0.0.1 -P 3306 -u root -p
</code></pre>
<ol>
<li>
<p>SHOW DATABASES：查看MySQL服务器中的所有数据库。执行语句如下：</p>
<p><code>SHOW DATABASES;</code></p>
</li>
<li>
<p>USE：使用该命令可以选择需要操作的数据库。语句如下：</p>
<p><code>USE 数据库名;</code></p>
</li>
<li>
<p>SHOW TABLES: 查看数据库中的所有表。语句如下：</p>
<p><code>SHOW TABLES;</code></p>
</li>
<li>
<p>SHOW COLUMNS: 查看表的所有字段信息。语句如下：</p>
<p><code>SHOW COLUMNS FROM 表名;</code></p>
</li>
<li>
<p>CREATE DATABASE: 创建新的数据库，语句如下：</p>
<p><code>CREATE DATABASE 数据库名;</code></p>
</li>
<li>
<p>DROP DATABASE: 删除数据库，语句如下：</p>
<p><code>DROP DATABASE 数据库名;</code></p>
</li>
<li>
<p>CREATE TABLE: 创建表，语句如下：</p>
<p><code>CREATE TABLE 表名 (字段1 类型,字段2 类型);</code></p>
</li>
<li>
<p>ALTER TABLE: 修改表的字段定义，语句如下：</p>
<p><code>ALTER TABLE 表名 MODIFY 字段名 类型；</code></p>
</li>
<li>
<p>DROP TABLE：删除表，语句如下：</p>
<p><code>DROP TABLE 表名;</code></p>
</li>
<li>
<p>INSERT：插入一条记录，语句如下：</p>
<p><code>INSERT INTO 表名 (字段1 ,字段2) VALUES (值1， 值2);</code></p>
</li>
<li>
<p>SELECT：查询表中的记录，语句如下：</p>
<p><code>SELECT * FROM 表名;</code></p>
</li>
<li>
<p>DELETE：删除满足条件的记录，语句如下：</p>
<p><code>DELETE FROM 表名 WHERE 条件;</code></p>
</li>
<li>
<p>UPDATE：更新满足条件记录，语句如下：</p>
<p><code>UPDATE 表名 SET 字段1=值1，字段2=值2 WHERE 条件;</code></p>
</li>
<li>
<p>TRUNCATE TABLE：清空表的所有记录，语句如下：</p>
<p><code>TRUNCATE TABLE 表名;</code></p>
</li>
<li>
<p>GRANT：给用户授权，语句如下：</p>
<p><code>GRANT 权限 ON 数据库名.表名 TO 用户名@主机；</code></p>
</li>
<li>
<p>DENY：拒绝用户访问，语句如下：</p>
<p><code>DENY 权限 ON 数据库名.表名 TO 用户名@主机；</code></p>
</li>
<li>
<p>BACKUP：备份数据库，语句如下：</p>
<p><code>mysqldump -u用户名 -p密码 -h主机 数据库名 &gt; 数据库名_备份文件名.sql</code></p>
</li>
<li>
<p>RESTORE：恢复数据库，语句如下：</p>
<p><code>mysql -u用户名 -p密码 -h主机 数据库名 &lt; 数据库名_备份文件名.sql</code></p>
</li>
<li>
<p>FLUSH TABLE：清楚某个表的缓存，语句如下：</p>
<p><code>FLUSH TABLE 表名;</code></p>
</li>
<li>
<p>FLUSH HOST：清除主机的缓存，语句如下：</p>
<p><code>FLUSH HOST;</code></p>
</li>
<li>
<p>FLUSH TABLES WITH READ LOCK：为表上锁，防止表被写操作，语句如下：</p>
<p><code>FLUSH TABLES WITH READ LOCK;</code></p>
</li>
<li>
<p>FLUSH PRIVILEGES：清除MySQL权限缓存，语句如下：</p>
<p><code>FLUSH PRIVILEGES;</code></p>
</li>
<li>
<p>SHOW ENGINE：显示MySQL内部引擎状态，语句如下：</p>
<p><code>SHOW ENGINE 引擎名称</code></p>
</li>
<li>
<p>SHOW VARIABLES：显示MySQL系统变量，语句如下：</p>
<p><code>SHOW VARIABLES;</code></p>
</li>
<li>
<p>SHOW STATUS：显示MySQL的执行情况，语句如下：</p>
<p><code>SHOW STATUS;</code></p>
</li>
<li>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/programs-client.html">MySQL Client Programs</a></p>
</li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/sql-statements.html">MySQL SQL Statements</a></li>
</ol>
<h2 id="connectorc">Connector/C++<a class="headerlink" href="#connectorc" title="Permanent link"></a></h2>
<p>MySQL Connector/C++ 是 MySQL 官方提供的一个 C++ 语言的数据库连接库，用于在 C++ 程序中与 MySQL 数据库进行交互。下面是一个简单的使用示例，展示如何连接到 MySQL 数据库、执行查询并处理结果。</p>
<h3 id="prepare-data">准备数据<a class="headerlink" href="#prepare-data" title="Permanent link"></a></h3>
<p>创建用户:</p>
<pre><code class="language-shell">jerry@jerry-Standard-PC-Q35-ICH9-2009:~$ mysql -u root -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 9
Server version: 8.0.34 MySQL Community Server - GPL

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; create user 'test' identified by 'dbtu2017';
Query OK, 0 rows affected (0.04 sec)

mysql&gt; create database test character set 'utf8mb4' collate 'utf8mb4_unicode_ci';
Query OK, 1 row affected (0.01 sec)

mysql&gt; 
mysql&gt; grant all privileges on test.* to 'test';
Query OK, 0 rows affected (0.01 sec)

mysql&gt; flush privileges;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; exit;
Bye
</code></pre>
<pre><code class="language-shell">jerry@jerry-Standard-PC-Q35-ICH9-2009:~$ mysql -u test -p test
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 10
Server version: 8.0.34 MySQL Community Server - GPL

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| performance_schema |
| test               |
+--------------------+
3 rows in set (0.01 sec)

mysql&gt; use test;
Database changed
mysql&gt; show tables;
Empty set (0.01 sec)

mysql&gt; create table students(id INT PRIMARY KEY, name VARCHAR(20) NOT NULL, age INT);
Query OK, 0 rows affected (0.04 sec)

mysql&gt; 
mysql&gt; show tables;
+----------------+
| Tables_in_test |
+----------------+
| students       |
+----------------+
1 row in set (0.01 sec)

mysql&gt; 
mysql&gt; insert into students(id, name, age) values(1, 'Tom', 18),(2, 'Jerry', 20),(3, 'Emily', 19);
Query OK, 3 rows affected (0.02 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql&gt; 
mysql&gt; select * from students;
+----+-------+------+
| id | name  | age  |
+----+-------+------+
|  1 | Tom   |   18 |
|  2 | Jerry |   20 |
|  3 | Emily |   19 |
+----+-------+------+
3 rows in set (0.00 sec)

mysql&gt; exit
Bye
</code></pre>
<h3 id="legacy-jdbc-api">legacy JDBC API<a class="headerlink" href="#legacy-jdbc-api" title="Permanent link"></a></h3>
<p>app.cc:</p>
<pre><code class="language-cpp">// #include &lt;jdbc/mysql_driver.h&gt;
// #include &lt;jdbc/mysql_connection.h&gt;
#include &lt;mysql/jdbc.h&gt;

int main() {
  try {
    sql::mysql::MySQL_Driver *driver;
    sql::Connection *con;
    sql::Statement *stmt;
    sql::ResultSet *res;

    // 创建 MySQL 驱动对象
    driver = sql::mysql::get_mysql_driver_instance();

    // 建立连接
    con = driver-&gt;connect(&quot;tcp://127.0.0.1:3306&quot;, &quot;test&quot;, &quot;dbtu2017&quot;);

    // 选择数据库
    con-&gt;setSchema(&quot;test&quot;);

    // 创建查询语句
    stmt = con-&gt;createStatement();
    res = stmt-&gt;executeQuery(&quot;select * from students&quot;);

    // 处理查询结果
    while(res-&gt;next()) {
      std::cout &lt;&lt; &quot;ID: &quot; &lt;&lt; res-&gt;getInt(&quot;id&quot;)
                &lt;&lt; &quot;, Name: &quot; &lt;&lt; res-&gt;getString(&quot;name&quot;)
                &lt;&lt; &quot;, Age: &quot; &lt;&lt; res-&gt;getInt(&quot;age&quot;)
                &lt;&lt; std::endl;
    }

    // 关闭连接
    delete res;
    delete stmt;
    delete con;
  } catch (const sql::SQLException &amp;err) {
    std::cout &lt;&lt; &quot;ERROR: &quot; &lt;&lt; err.what() &lt;&lt; std::endl;
    return 1;
  } catch (std::exception &amp;ex) {
    std::cout &lt;&lt; &quot;STD EXCEPTION: &quot; &lt;&lt; ex.what() &lt;&lt; std::endl;
    return 1;
  } catch (const char *ex) {
    std::cout &lt;&lt; &quot;EXCEPTION: &quot; &lt;&lt; ex &lt;&lt; std::endl;
    return 1;
  }
  return 0;
}
</code></pre>
<p>Makefile:</p>
<pre><code class="language-makefile"># Using the Connector/C++ Dynamic Library
# MYSQL_CONCPP_DIR = /home/jerry/Downloads/mysql-connector-c++-8.0.33-linux-glibc2.28-x86-64bit
# CPPFLAGS = -I $(MYSQL_CONCPP_DIR)/include -L $(MYSQL_CONCPP_DIR)/lib64
# LDLIBS = -lmysqlcppconn

# Using the Connector/C++ Static Library
MYSQL_CONCPP_DIR = /home/jerry/Downloads/libmysqlcppconn-dev_8.0.33-1ubuntu20.04_amd64
# MYSQL_CONCPP_DIR = /home/jerry/Downloads/mysql-connector-c++-8.0.33-linux-glibc2.28-x86-64bit
CPPFLAGS = -DSTATIC_CONCPP -I $(MYSQL_CONCPP_DIR)/include
LDLIBS = $(MYSQL_CONCPP_DIR)/lib64/libmysqlcppconn-static.a -lssl -lcrypto -lpthread -lresolv -ldl -lstdc++

all: app
app: app.cc
clean:
    -@rm -f app
</code></pre>
<p>动态链接使用的是 <a href="https://downloads.mysql.com/archives/get/p/20/file/mysql-connector-c%2B%2B-8.0.33-linux-glibc2.28-x86-64bit.tar.gz">mysql-connector-c++-8.0.33-linux-glibc2.28-x86-64bit.tar.gz</a>。
编译后运行可能会提示找不到 <code>libmysqlcppconn.so.9</code>，这是因为链接用的动态库并不在运行时的环境变量中，执行命令 <code>export LD_LIBRARY_PATH=/home/jerry/Downloads/mysql-connector-c++-8.0.33-linux-glibc2.28-x86-64bit/lib64</code> 即可。</p>
<p>这个包里面也有静态链接库，但是编译的时候总是报链接错误。这可能是由于 C++ 标准库的版本不匹配或者链接的顺序不正确所致。(比如 libmysqlcppconn-static.a 是用 gcc-12 版本编译的，而我的编译环境是 gcc 9.4.0，使用不了高版本的静态库。)</p>
<p>后来我专门下载了 Ubuntu 版本的 <a href="https://downloads.mysql.com/archives/get/p/20/file/libmysqlcppconn-dev_8.0.33-1ubuntu20.04_amd64.deb">libmysqlcppconn-dev_8.0.33-1ubuntu20.04_amd64.deb</a>，使用这个 DEB Package 里面的静态链接库编译链接运行都很正常。</p>
<h3 id="x-devapi">X DevAPI<a class="headerlink" href="#x-devapi" title="Permanent link"></a></h3>
<p>app.cc:</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;mysqlx/xdevapi.h&gt;

using ::std::cout;
using ::std::endl;
using namespace ::mysqlx;


int main(int argc, const char* argv[])
try {

  const char   *url = (argc &gt; 1 ? argv[1] : &quot;mysqlx://test:dbtu2017@127.0.0.1&quot;);

  cout &lt;&lt; &quot;Creating session on &quot; &lt;&lt; url
       &lt;&lt; &quot; ...&quot; &lt;&lt; endl;

  Session sess(url);

  cout &lt;&lt;&quot;Session accepted, creating collection...&quot; &lt;&lt;endl;

  Schema sch= sess.getSchema(&quot;test&quot;);
  Collection coll= sch.createCollection(&quot;c1&quot;, true);

  cout &lt;&lt;&quot;Inserting documents...&quot; &lt;&lt;endl;

  coll.remove(&quot;true&quot;).execute();

  {
    DbDoc doc(R&quot;({ &quot;name&quot;: &quot;foo&quot;, &quot;age&quot;: 1 })&quot;);

    Result add =
      coll.add(doc)
          .add(R&quot;({ &quot;name&quot;: &quot;bar&quot;, &quot;age&quot;: 2, &quot;toys&quot;: [ &quot;car&quot;, &quot;ball&quot; ] })&quot;)
          .add(R&quot;({ &quot;name&quot;: &quot;bar&quot;, &quot;age&quot;: 2, &quot;toys&quot;: [ &quot;car&quot;, &quot;ball&quot; ] })&quot;)
          .add(R&quot;({
                 &quot;name&quot;: &quot;baz&quot;,
                  &quot;age&quot;: 3,
                 &quot;date&quot;: { &quot;day&quot;: 20, &quot;month&quot;: &quot;Apr&quot; }
              })&quot;)
          .add(R&quot;({ &quot;_id&quot;: &quot;myuuid-1&quot;, &quot;name&quot;: &quot;foo&quot;, &quot;age&quot;: 7 })&quot;)
          .execute();

    std::list&lt;string&gt; ids = add.getGeneratedIds();
    for (string id : ids)
      cout &lt;&lt;&quot;- added doc with id: &quot; &lt;&lt; id &lt;&lt;endl;
  }

  cout &lt;&lt;&quot;Fetching documents...&quot; &lt;&lt;endl;

  DocResult docs = coll.find(&quot;age &gt; 1 and name like 'ba%'&quot;).execute();

  int i = 0;
  for (DbDoc doc : docs)
  {
    cout &lt;&lt;&quot;doc#&quot; &lt;&lt;i++ &lt;&lt;&quot;: &quot; &lt;&lt;doc &lt;&lt;endl;

    for (Field fld : doc)
    {
      cout &lt;&lt; &quot; field `&quot; &lt;&lt; fld &lt;&lt; &quot;`: &quot; &lt;&lt;doc[fld] &lt;&lt; endl;
    }

    string name = doc[&quot;name&quot;];
    cout &lt;&lt; &quot; name: &quot; &lt;&lt; name &lt;&lt; endl;

    if (doc.hasField(&quot;date&quot;) &amp;&amp; Value::DOCUMENT == doc.fieldType(&quot;date&quot;))
    {
      cout &lt;&lt; &quot;- date field&quot; &lt;&lt; endl;
      DbDoc date = doc[&quot;date&quot;];
      for (Field fld : date)
      {
        cout &lt;&lt; &quot;  date `&quot; &lt;&lt; fld &lt;&lt; &quot;`: &quot; &lt;&lt; date[fld] &lt;&lt; endl;
      }
      string month = doc[&quot;date&quot;][&quot;month&quot;];
      int day = date[&quot;day&quot;];
      cout &lt;&lt; &quot;  month: &quot; &lt;&lt; month &lt;&lt; endl;
      cout &lt;&lt; &quot;  day: &quot; &lt;&lt; day &lt;&lt; endl;
    }

    if (doc.hasField(&quot;toys&quot;) &amp;&amp; Value::ARRAY == doc.fieldType(&quot;toys&quot;))
    {
      cout &lt;&lt; &quot;- toys:&quot; &lt;&lt; endl;
      for (auto toy : doc[&quot;toys&quot;])
      {
        cout &lt;&lt; &quot;  &quot; &lt;&lt; toy &lt;&lt; endl;
      }
    }

    cout &lt;&lt; endl;
  }
  cout &lt;&lt;&quot;Done!&quot; &lt;&lt;endl;
}
catch (const mysqlx::Error &amp;err)
{
  cout &lt;&lt;&quot;ERROR: &quot; &lt;&lt;err &lt;&lt;endl;
  return 1;
}
catch (std::exception &amp;ex)
{
  cout &lt;&lt;&quot;STD EXCEPTION: &quot; &lt;&lt;ex.what() &lt;&lt;endl;
  return 1;
}
catch (const char *ex)
{
  cout &lt;&lt;&quot;EXCEPTION: &quot; &lt;&lt;ex &lt;&lt;endl;
  return 1;
}
</code></pre>
<p>Makefile:</p>
<pre><code class="language-makefile"># Using the Connector/C++ Dynamic Library
# MYSQL_CONCPP_DIR = /home/jerry/Downloads/mysql-connector-c++-8.0.33-linux-glibc2.28-x86-64bit
# CPPFLAGS = -I $(MYSQL_CONCPP_DIR)/include -L $(MYSQL_CONCPP_DIR)/lib64
# LDLIBS = -lmysqlcppconn8
# CXXFLAGS = -std=c++17

# Using the Connector/C++ Static Library
MYSQL_CONCPP_DIR = /home/jerry/Downloads/libmysqlcppconn-dev_8.0.33-1ubuntu20.04_amd64
# MYSQL_CONCPP_DIR = /home/jerry/Downloads/mysql-connector-c++-8.0.33-linux-glibc2.28-x86-64bit
CPPFLAGS = -DSTATIC_CONCPP -I $(MYSQL_CONCPP_DIR)/include
LDLIBS = $(MYSQL_CONCPP_DIR)/lib64/libmysqlcppconn8-static.a -lssl -lcrypto -lpthread -lresolv -ldl -lstdc++
CXXFLAGS = -std=c++17

all: app
app: app.cc
clean:
    -@rm -f app
</code></pre>
<p>使用静态库时遇到了和上面一样的问题，通过下载跟本地环境同系统版本的开发库解决。</p>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/connector-cpp-info.html">MySQL Connector/C++</a></li>
<li><a href="https://github.com/mysql/mysql-connector-cpp">MySQL Connector/C++</a></li>
</ul>
<h2 id="references">参考资料<a class="headerlink" href="#references" title="Permanent link"></a></h2>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/">MySQL 8.0 Reference Manual</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2022 Jerry, All Rights Reserved.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
