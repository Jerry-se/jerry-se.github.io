<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Jerry">
        <link rel="canonical" href="https://jerry-se.github.io/go/generics/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Generics - Jerry's blog</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../css/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/django.min.js"></script>
        <script>hljs.highlightAll();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-274394082"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', "G-274394082");
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Jerry's blog</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../markdown/" class="nav-link">Markdown</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">C/C++</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../cplusplus/lambda/" class="dropdown-item">Lambda</a>
</li>
                                    
<li>
    <a href="../../cplusplus/questions/" class="dropdown-item">Questions</a>
</li>
                                    
<li>
    <a href="../../cplusplus/bit_xor/" class="dropdown-item">Bit Xor</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Go</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../go/" class="dropdown-item">Go tutorial</a>
</li>
                                    
<li>
    <a href="../install/" class="dropdown-item">Install</a>
</li>
                                    
<li>
    <a href="../getting_started/" class="dropdown-item">Getting started</a>
</li>
                                    
<li>
    <a href="../create_module/" class="dropdown-item">Create module</a>
</li>
                                    
<li>
    <a href="../workspaces/" class="dropdown-item">Workspaces</a>
</li>
                                    
<li>
    <a href="../web_service_gin/" class="dropdown-item">Web service gin</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Generics</a>
</li>
                                    
<li>
    <a href="../writing_web_app/" class="dropdown-item">Writing Web app</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Tool</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../git/git/" class="dropdown-item">Git</a>
</li>
                                    
<li>
    <a href="../../git/git_lfs/" class="dropdown-item">Git LFS</a>
</li>
                                    
<li>
    <a href="../../git/gitea/" class="dropdown-item">Gitea</a>
</li>
                                    
<li>
    <a href="../../tool/frp/" class="dropdown-item">Frp</a>
</li>
                                    
<li>
    <a href="../../tool/v2ray/" class="dropdown-item">V2Ray</a>
</li>
                                    
<li>
    <a href="../../tool/activation_keys/" class="dropdown-item">Activation</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Python</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../python/build_blogs_with_pelican/" class="dropdown-item">Pelican</a>
</li>
                                    
<li>
    <a href="../../python/mkdocs/" class="dropdown-item">MkDocs</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Linux 开发</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../linux_development/docker/" class="dropdown-item">docker</a>
</li>
                                    
<li>
    <a href="../../linux_development/coredump/" class="dropdown-item">coredump</a>
</li>
                                    
<li>
    <a href="../../linux_development/ipmi/" class="dropdown-item">ipmi</a>
</li>
                                    
<li>
    <a href="../../linux_development/make_deb_package/" class="dropdown-item">制作 deb 安装包</a>
</li>
                                    
<li>
    <a href="../../linux_development/samba/" class="dropdown-item">Samba</a>
</li>
                                    
<li>
    <a href="../../linux_development/scsi/" class="dropdown-item">SCSI</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Windows 开发</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../windows_development/character_encoding/" class="dropdown-item">字符编码</a>
</li>
                                    
<li>
    <a href="../../windows_development/autostart/" class="dropdown-item">开机启动</a>
</li>
                                    
<li>
    <a href="../../windows_development/automatic_power_up/" class="dropdown-item">自动开机</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../../sitemap/" class="nav-link">Index</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../web_service_gin/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../writing_web_app/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#getting-started-with-generics" class="nav-link">泛型入门</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#create-folder-for-code" class="nav-link">1. 为您的代码创建一个文件夹</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#non-generic-functions" class="nav-link">2. 添加非泛型函数</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="3"><a href="#write-code-21" class="nav-link">2.1. 编写代码</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#run-code-21" class="nav-link">2.2. 运行代码</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#add-generic-function" class="nav-link">3. 添加泛型函数处理多种类型</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="3"><a href="#write-code-31" class="nav-link">3.1. 编写代码</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#run-code-32" class="nav-link">3.2. 运行代码</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#calling-generic-function" class="nav-link">4. 简化调用泛型函数</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="3"><a href="#write-code-41" class="nav-link">4.1. 编写代码</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#run-code-42" class="nav-link">4.2. 运行代码</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#declare-type-constraint" class="nav-link">5. 声明类型约束</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="3"><a href="#write-code-51" class="nav-link">5.1. 编写代码</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="3"><a href="#run-code-52" class="nav-link">5.2. 运行代码</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#conclusion" class="nav-link">结论</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#completed-code" class="nav-link">完整的代码</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#references" class="nav-link">参考资料</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="getting-started-with-generics">泛型入门<a class="headerlink" href="#getting-started-with-generics" title="Permanent link"></a></h1>
<p>本教程介绍 Go 中泛型的基础知识。使用泛型，您可以为调用代码声明和使用的函数或类型编写提供任何一组类型。</p>
<hr />
<p>在本教程中，您将声明两个简单的非泛型函数，然后在单个泛型函数中捕获相同的逻辑。</p>
<p>您将逐步完成以下部分：</p>
<ol>
<li>为您的代码创建一个文件夹。</li>
<li>添加非泛型函数。</li>
<li>添加一个泛型函数来处理多种类型。</li>
<li>调用泛型函数时删除类型参数。</li>
<li>声明类型约束。</li>
</ol>
<p><strong>注意</strong>：如果您愿意，可以使用 <a href="https://go.dev/play/?v=gotip">“Go dev branch”模式下的 Go Playground</a> 来编辑和运行您的程序。</p>
<blockquote>
<p>Go 1.18 或更高版本</p>
</blockquote>
<h2 id="create-folder-for-code">1. 为您的代码创建一个文件夹<a class="headerlink" href="#create-folder-for-code" title="Permanent link"></a></h2>
<p>首先，为您要编写的代码创建一个文件夹。</p>
<ol>
<li>打开命令提示符并切换到您的主目录。</li>
<li>
<p>在命令提示符下，为您的代码创建一个名为 generics 的目录。</p>
<pre><code>$ mkdir generics
$ cd generics
</code></pre>
</li>
<li>
<p>创建一个模块来保存您的代码。</p>
<p>运行<code>go mod init</code>命令，为其提供新代码的模块路径。</p>
<pre><code>$ go mod init example/generics
go: creating new go.mod: module example/generics
</code></pre>
<p>注意：对于生产代码，您需要指定一个更符合您自己需求的模块路径。有关更多信息，请务必查看 <a href="https://go.dev/doc/modules/managing-dependencies">管理依赖项</a>。</p>
</li>
</ol>
<p>接下来，您将添加一些简单的代码来处理 map。</p>
<h2 id="non-generic-functions">2. 添加非泛型函数<a class="headerlink" href="#non-generic-functions" title="Permanent link"></a></h2>
<p>在此步骤中，您将添加两个函数，每个函数将 map 的值相加并返回总数。</p>
<p>您要声明两个函数而不是一个，因为您正在使用两种不同类型的 map：一种用于存储<code>int64</code>值，另一种用于存储<code>float64</code>值。</p>
<h3 id="write-code-21">2.1. 编写代码<a class="headerlink" href="#write-code-21" title="Permanent link"></a></h3>
<ol>
<li>
<p>使用您的文本编辑器，在 generics 目录中创建一个名为 main.go 的文件。您将在此文件中编写您的 Go 代码。</p>
</li>
<li>
<p>进入 main.go，在文件顶部，粘贴以下包声明。</p>
<pre><code>package main
</code></pre>
<p>独立程序（与库相反）始终位于 package main 中。</p>
</li>
<li>
<p>在包声明下方，粘贴以下两个函数声明。</p>
<pre><code>// SumInts adds together the values of m.
func SumInts(m map[string]int64) int64 {
    var s int64
    for _, v := range m {
        s += v
    }
    return s
}

// SumFloats adds together the values of m.
func SumFloats(m map[string]float64) float64 {
    var s float64
    for _, v := range m {
        s += v
    }
    return s
}
</code></pre>
<p>在此代码中，您：</p>
<ul>
<li>声明两个函数以将map的值相加并返回总和。<ul>
<li><code>SumFloats</code>获取<code>string</code>到<code>float64</code>值的map映射。</li>
<li><code>SumInts</code>获取<code>string</code>到<code>int64</code>值的map映射。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>在 main.go 顶部的包声明下方，粘贴以下 <code>main</code> 函数以初始化两个映射，并在调用您在上一步中声明的函数时将它们用作参数。</p>
<pre><code>func main() {
    // Initialize a map for the integer values
    ints := map[string]int64{
        "first":  34,
        "second": 12,
    }

    // Initialize a map for the float values
    floats := map[string]float64{
        "first":  35.98,
        "second": 26.99,
    }

    fmt.Printf("Non-Generic Sums: %v and %v\n",
        SumInts(ints),
        SumFloats(floats))
}
</code></pre>
<p>在此代码中，您：</p>
<ul>
<li>初始化一个<code>float64</code>值map映射和一个<code>int64</code>值map映射，每个都有两个条目。</li>
<li>调用您之前声明的两个函数来查找每个映射值的总和。</li>
<li>打印结果。</li>
</ul>
</li>
<li>
<p>在 main.go 顶部附近，就在包声明的下方，导入您需要支持您刚刚编写的代码的包。</p>
<p>第一行代码应如下所示：</p>
<pre><code>package main

import "fmt"
</code></pre>
</li>
<li>
<p>保存 main.go。</p>
</li>
</ol>
<h3 id="run-code-21">2.2. 运行代码<a class="headerlink" href="#run-code-21" title="Permanent link"></a></h3>
<p>从包含 main.go 的目录中的命令行，运行代码。</p>
<pre><code>$ go run .
Non-Generic Sums: 46 and 62.97
</code></pre>
<p>使用泛型，您可以在此处编写一个函数而不是两个。接下来，您将为包含整数或浮点值的map映射添加一个泛型函数。</p>
<h2 id="add-generic-function">3. 添加泛型函数处理多种类型<a class="headerlink" href="#add-generic-function" title="Permanent link"></a></h2>
<p>在本节中，您将添加一个泛型函数，该函数可以接收包含整数或浮点值的map映射，从而有效地将您刚刚编写的两个函数替换为一个函数。</p>
<p>要支持任一类型的值，该单个函数将需要一种方法来声明它支持的类型。另一方面，调用代码需要一种方法来指定它是使用整数map还是浮点map。</p>
<p>为了支持这一点，您将编写一个函数，该函数在其普通函数参数之外还声明<em>类型参数</em>(type parameters)。这些类型参数使函数具有通用性，使其能够处理不同类型的参数。您将使用类型参数和普通函数参数调用该函数。</p>
<p>每个类型参数都有一个<em>类型约束</em>(type constraint)，它充当类型参数的一种元类型(meta-type)。每个类型约束指定调用代码可用于相应类型参数的允许类型参数。</p>
<p>虽然类型参数的约束通常表示一组类型，但在编译时，类型参数代表单一类型——调用代码作为类型参数提供的类型。如果类型参数的约束不允许类型参数的类型，则代码将无法编译。</p>
<p>请记住，类型参数必须支持泛型代码对其执行的所有操作。例如，如果您的函数代码尝试对其约束类型包括数字类型的类型参数执行<code>string</code>操作（例如索引），则代码将无法编译。</p>
<p>在您即将编写的代码中，您将使用允许整数或浮点类型的约束。</p>
<h3 id="write-code-31">3.1. 编写代码<a class="headerlink" href="#write-code-31" title="Permanent link"></a></h3>
<ol>
<li>
<p>在您之前添加的两个函数下方，粘贴以下泛型函数。</p>
<pre><code>// SumIntsOrFloats sums the values of map m. It supports both int64 and float64
// as types for map values.
func SumIntsOrFloats[K comparable, V int64 | float64](m map[K]V) V {
    var s V
    for _, v := range m {
        s += v
    }
    return s
}
</code></pre>
<p>在此代码中，您：</p>
<ul>
<li>声明一个<code>SumIntsOrFloats</code>函数具有两个类型参数（在方括号内）<code>K</code>和<code>V</code>，以及一个使用类型参数的参数<code>m</code>，类型为<code>map[K]V</code>。该函数返回一个<code>V</code>类型的值。</li>
<li>为<code>K</code>类型参数指定类型约束<code>comparable</code>。专门针对此类情况，在 Go 中预先声明了约束<code>comparable</code>。它允许值可以用作比较运算符<code>==</code>和<code>!=</code>的操作数的任何类型。Go 要求map映射的keys具有可比性。所以声明<code>K</code>为<code>ascomparable</code>是必要的，这样您就可以使用<code>K</code>在 map 变量中作为key键。它还确保调用代码对映射键使用允许的类型。</li>
<li>为<code>V</code>类型参数指定一个约束，它是两种类型的联合：<code>int64</code>和<code>float64</code>。使用<code>|</code>指定两种类型的联合，这意味着此约束允许任何一种类型。编译器将允许任一类型作为调用代码中的参数。</li>
<li>指定参数<code>m</code>类型是 <code>map[K]V</code>，其中<code>K</code>和<code>V</code>是已经为类型参数指定的类型。请注意，我们知道<code>map[K]V</code>是有效的map类型，因为<code>K</code>是可比较的类型。如果我们没有声明<code>K</code>可比较，编译器将拒绝<code>map[K]V</code>键值对.</li>
</ul>
</li>
<li>
<p>在 main.go 中，在您已有的代码下方，粘贴以下代码。</p>
<pre><code>fmt.Printf("Generic Sums: %v and %v\n",
    SumIntsOrFloats[string, int64](ints),
    SumIntsOrFloats[string, float64](floats))
</code></pre>
<p>在此代码中，您：</p>
<ul>
<li>调用您刚刚声明的通用函数，传递您创建的每个映射。</li>
<li>
<p>指定类型参数 - 方括号中的类型名称 - 以明确应该替换您正在调用的函数中的类型参数的类型。</p>
<p>正如您将在下一节中看到的，您通常可以在函数调用中省略类型参数。Go 通常可以从你的代码中推断出它们。</p>
</li>
<li>
<p>打印函数返回的总和。</p>
</li>
</ul>
</li>
</ol>
<h3 id="run-code-32">3.2. 运行代码<a class="headerlink" href="#run-code-32" title="Permanent link"></a></h3>
<p>从包含 main.go 的目录中的命令行，运行代码。</p>
<pre><code>$ go run .
Non-Generic Sums: 46 and 62.97
Generic Sums: 46 and 62.97
</code></pre>
<p>为了运行您的代码，在每次调用中，编译器将类型参数替换为该调用中指定的具体类型。</p>
<p>在调用您编写的泛型函数时，您指定了类型参数，告诉编译器使用什么类型代替函数的类型参数。正如您将在下一节中看到的，在许多情况下您可以省略这些类型参数，因为编译器可以推断它们。</p>
<h2 id="calling-generic-function">4. 简化调用泛型函数<a class="headerlink" href="#calling-generic-function" title="Permanent link"></a></h2>
<p>在本节中，您将添加泛型函数调用的修改版本，进行小的更改以简化调用代码。您将删除在这种情况下不需要的类型参数。</p>
<p>当 Go 编译器可以推断您要使用的类型时，您可以在调用代码中省略类型参数。编译器从函数参数的类型推断类型参数。</p>
<p>请注意，这并不总是可能的。例如，如果您需要调用没有参数的泛型函数，则需要在函数调用中包含类型参数。</p>
<h3 id="write-code-41">4.1. 编写代码<a class="headerlink" href="#write-code-41" title="Permanent link"></a></h3>
<ol>
<li>
<p>在 main.go 中，在您已有的代码下方，粘贴以下代码。</p>
<pre><code>fmt.Printf("Generic Sums, type parameters inferred: %v and %v\n",
    SumIntsOrFloats(ints),
    SumIntsOrFloats(floats))
</code></pre>
<p>在此代码中，您：</p>
<ul>
<li>调用泛型函数，省略类型参数。</li>
</ul>
</li>
</ol>
<h3 id="run-code-42">4.2. 运行代码<a class="headerlink" href="#run-code-42" title="Permanent link"></a></h3>
<p>从包含 main.go 的目录中的命令行，运行代码。</p>
<pre><code>$ go run .
Non-Generic Sums: 46 and 62.97
Generic Sums: 46 and 62.97
Generic Sums, type parameters inferred: 46 and 62.97
</code></pre>
<p>接下来，您将通过将整数和浮点数的并集捕获到您可以重用的类型约束（例如从其他代码中）来进一步简化函数。</p>
<h2 id="declare-type-constraint">5. 声明类型约束<a class="headerlink" href="#declare-type-constraint" title="Permanent link"></a></h2>
<p>在最后一部分中，您将把之前定义的约束移到它自己的接口中，以便您可以在多个地方重用它。以这种方式声明约束有助于简化代码，例如当约束更复杂时。</p>
<p>您将<em>类型约束</em>声明为接口。约束允许任何类型实现接口。例如，如果您声明了具有三个方法的类型约束接口，然后在泛型函数中将其与类型参数一起使用，则用于调用该函数的类型参数必须具有所有这些方法。</p>
<p>正如您将在本节中看到的，约束接口也可以引用特定类型。</p>
<h3 id="write-code-51">5.1. 编写代码<a class="headerlink" href="#write-code-51" title="Permanent link"></a></h3>
<ol>
<li>
<p>就在main上面，紧跟在 import 语句之后，粘贴以下代码来声明类型约束。</p>
<pre><code>type Number interface {
    int64 | float64
}
</code></pre>
<p>在此代码中，您：</p>
<ul>
<li>声明<code>Number</code>要用作类型约束的接口类型。</li>
<li>
<p>在接口内部声明一个<code>int64</code>和<code>float64</code>的并集(union)。</p>
<p>本质上，您正在将联合(union)从函数声明移动到新的类型约束中。这样一来，当您想将类型参数约束为<code>int64</code>或<code>float64</code>时，您可以使用此<code>Number</code>类型约束来代替<code>int64 | float64</code>。</p>
</li>
</ul>
</li>
<li>
<p>在您已有的函数下方，粘贴以下通用 <code>SumNumbers</code> 函数。</p>
<pre><code>// SumNumbers sums the values of map m. It supports both integers
// and floats as map values.
func SumNumbers[K comparable, V Number](m map[K]V) V {
    var s V
    for _, v := range m {
        s += v
    }
    return s
}
</code></pre>
<p>在此代码中，您：</p>
<ul>
<li>声明一个与您之前声明的泛型函数具有相同逻辑的泛型函数，但使用新的接口类型而不是联合作为类型约束。和以前一样，您使用类型参数作为参数和返回类型。</li>
</ul>
</li>
<li>
<p>在 main.go 中，在您已有的代码下方，粘贴以下代码。</p>
<pre><code>fmt.Printf("Generic Sums with Constraint: %v and %v\n",
    SumNumbers(ints),
    SumNumbers(floats))
</code></pre>
<p>在此代码中，您：</p>
<ul>
<li>
<p>以每个map为参数调用<code>SumNumbers</code>，打印其值的总和。</p>
<p>与上一节一样，在调用泛型函数时省略了类型参数（方括号中的类型名称）。Go 编译器可以从其他参数推断类型参数。</p>
</li>
</ul>
</li>
</ol>
<h3 id="run-code-52">5.2. 运行代码<a class="headerlink" href="#run-code-52" title="Permanent link"></a></h3>
<p>从包含 main.go 的目录中的命令行，运行代码。</p>
<pre><code>$ go run .
Non-Generic Sums: 46 and 62.97
Generic Sums: 46 and 62.97
Generic Sums, type parameters inferred: 46 and 62.97
Generic Sums with Constraint: 46 and 62.97
</code></pre>
<h2 id="conclusion">结论<a class="headerlink" href="#conclusion" title="Permanent link"></a></h2>
<p>做得很好！您刚刚向自己介绍了 Go 中的泛型。</p>
<p>建议的下一个主题：</p>
<ul>
<li><a href="https://tour.golang.org/welcome/1">Go Tour</a>是对 Go 基础知识的逐步介绍。</li>
<li>您将在 <a href="https://go.dev/doc/effective_go">Effective Go</a> 和 <a href="https://go.dev/doc/code">How to write Go code</a> 中找到有用的 Go 最佳实践。</li>
</ul>
<h2 id="completed-code">完整的代码<a class="headerlink" href="#completed-code" title="Permanent link"></a></h2>
<p>你可以在 <a href="https://go.dev/play/p/apNmfVwogK0?v=gotip">Go playground</a> 上运行这个程序 。在操场(playground)上，只需单击“<strong>Run</strong>”按钮。</p>
<pre><code class="language-golang">package main

import &quot;fmt&quot;

type Number interface {
    int64 | float64
}

func main() {
    // Initialize a map for the integer values
    ints := map[string]int64{
        &quot;first&quot;: 34,
        &quot;second&quot;: 12,
    }

    // Initialize a map for the float values
    floats := map[string]float64{
        &quot;first&quot;: 35.98,
        &quot;second&quot;: 26.99,
    }

    fmt.Printf(&quot;Non-Generic Sums: %v and %v\n&quot;,
        SumInts(ints),
        SumFloats(floats))

    fmt.Printf(&quot;Generic Sums: %v and %v\n&quot;,
        SumIntsOrFloats[string, int64](ints),
        SumIntsOrFloats[string, float64](floats))

    fmt.Printf(&quot;Generic Sums, type parameters inferred: %v and %v\n&quot;,
        SumIntsOrFloats(ints),
        SumIntsOrFloats(floats))

    fmt.Printf(&quot;Generic Sums with Constraint: %v and %v\n&quot;,
        SumNumbers(ints),
        SumNumbers(floats))
}

// SumInts adds together the values of m.
func SumInts(m map[string]int64) int64 {
    var s int64
    for _, v := range m {
        s += v
    }
    return s
}

// SumFloats adds together the values of m.
func SumFloats(m map[string]float64) float64 {
    var s float64
    for _, v := range m {
        s += v
    }
    return s
}

// SumIntsOrFloats sums the values of map m. It supports both floats and integers
// as map values.
func SumIntsOrFloats[K comparable, V int64 | float64](m map[K]V) V {
    var s V
    for _, v := range m {
        s += v
    }
    return s
}

// SumNumbers sums the values of map m. Its supports both integers
// and floats as map values.
func SumNumbers[K comparable, V Number](m map[K]V) V {
    var s V
    for _, v := range m {
        s += v
    }
    return s
}
</code></pre>
<h2 id="references">参考资料<a class="headerlink" href="#references" title="Permanent link"></a></h2>
<p><a href="https://go.dev/doc/tutorial/generics">https://go.dev/doc/tutorial/generics</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2022 Jerry, All Rights Reserved.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
