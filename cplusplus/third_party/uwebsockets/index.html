<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Jerry">
        <link rel="canonical" href="https://jerry-se.github.io/cplusplus/third_party/uwebsockets/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>µWebSockets - Jerry's blog</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../../css/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/django.min.js"></script>
        <script>hljs.highlightAll();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-274394082"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', "G-274394082");
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">Jerry's blog</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../../markdown/" class="nav-link">Markdown</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">C/C++</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../lambda/" class="dropdown-item">Lambda</a>
</li>
                                    
<li>
    <a href="../../questions/" class="dropdown-item">Questions</a>
</li>
                                    
<li>
    <a href="../../bit_xor/" class="dropdown-item">Bit Xor</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Go</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../go/go/" class="dropdown-item">Go tutorial</a>
</li>
                                    
<li>
    <a href="../../../go/install/" class="dropdown-item">Install</a>
</li>
                                    
<li>
    <a href="../../../go/getting_started/" class="dropdown-item">Getting started</a>
</li>
                                    
<li>
    <a href="../../../go/create_module/" class="dropdown-item">Create module</a>
</li>
                                    
<li>
    <a href="../../../go/workspaces/" class="dropdown-item">Workspaces</a>
</li>
                                    
<li>
    <a href="../../../go/web_service_gin/" class="dropdown-item">Web service gin</a>
</li>
                                    
<li>
    <a href="../../../go/generics/" class="dropdown-item">Generics</a>
</li>
                                    
<li>
    <a href="../../../go/writing_web_app/" class="dropdown-item">Writing Web app</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Tool</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../git/git/" class="dropdown-item">Git</a>
</li>
                                    
<li>
    <a href="../../../git/git_lfs/" class="dropdown-item">Git LFS</a>
</li>
                                    
<li>
    <a href="../../../git/gitea/" class="dropdown-item">Gitea</a>
</li>
                                    
<li>
    <a href="../../../tool/frp/" class="dropdown-item">Frp</a>
</li>
                                    
<li>
    <a href="../../../tool/v2ray/" class="dropdown-item">V2Ray</a>
</li>
                                    
<li>
    <a href="../../../tool/activation_keys/" class="dropdown-item">Activation</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Python</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../python/build_blogs_with_pelican/" class="dropdown-item">Pelican</a>
</li>
                                    
<li>
    <a href="../../../python/mkdocs/" class="dropdown-item">MkDocs</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Linux 开发</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../linux_development/docker/" class="dropdown-item">docker</a>
</li>
                                    
<li>
    <a href="../../../linux_development/coredump/" class="dropdown-item">coredump</a>
</li>
                                    
<li>
    <a href="../../../linux_development/ipmi/" class="dropdown-item">ipmi</a>
</li>
                                    
<li>
    <a href="../../../linux_development/make_deb_package/" class="dropdown-item">制作 deb 安装包</a>
</li>
                                    
<li>
    <a href="../../../linux_development/samba/" class="dropdown-item">Samba</a>
</li>
                                    
<li>
    <a href="../../../linux_development/scsi/" class="dropdown-item">SCSI</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Windows 开发</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../windows_development/character_encoding/" class="dropdown-item">字符编码</a>
</li>
                                    
<li>
    <a href="../../../windows_development/autostart/" class="dropdown-item">开机启动</a>
</li>
                                    
<li>
    <a href="../../../windows_development/automatic_power_up/" class="dropdown-item">自动开机</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../../../sitemap/" class="nav-link">Index</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#websockets" class="nav-link">µWebSockets</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#introduction" class="nav-link">介绍</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#compile" class="nav-link">编译</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#example" class="nav-link">示例</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#references" class="nav-link">参考资料</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="websockets">µWebSockets<a class="headerlink" href="#websockets" title="Permanent link"></a></h1>
<p>µWebSockets 是一款高度可拓展的最轻量级、效率最高的 WebSocket 服务器库之一。</p>
<h2 id="introduction">介绍<a class="headerlink" href="#introduction" title="Permanent link"></a></h2>
<p>μWebSockets 是 ws 的直接替代品，实施时特别注重性能和稳定性。</p>
<p>μWebSockets 是最快的 WebSocket 服务器实现。针对速度和内存占用进行了精心优化，其速度足以完成加密的 TLS 1.3 消息传递，甚至比大多数替代服务器执行未加密的明文消息传递的速度还要快。</p>
<p>µWebSockets 完全用 C 和 C++ 编写，但与 Node.js 后端无缝集成。</p>
<p>µWebSockets 为世界上许多最大的加密货币交易所提供支持，每天处理数十亿美元的交易量。如果您交易加密货币，您很可能通过 µWebSockets 进行交易。</p>
<p>µWebSockets 构建于 <a href="https://github.com/uNetworking/uSockets">µSockets</a> 之上，这是一个在三个不同层中实现事件、网络和加密的基础库。每个层都有多个实现，您可以使用标志来控制编译的组合。目前有五个事件循环集成: libuv、ASIO、GCD 和原始 epoll/kqueue。</p>
<h2 id="compile">编译<a class="headerlink" href="#compile" title="Permanent link"></a></h2>
<p>主干的代码需要 C++20 ，至少 GCC 10 以上版本，若要在 Ubuntu 20.04 系统上使用，可以使用 v0.17.6 分支的代码。</p>
<pre><code class="language-shell">dbtu@dbtu:~/code/uWebSockets$ git clone git@github.com:uNetworking/uWebSockets.git --recurse-submodules
dbtu@dbtu:~/code/uWebSockets$ git checkout v0.17.6
dbtu@dbtu:~/code/uWebSockets$ make
</code></pre>
<p><a href="https://github.com/uNetworking/uWebSockets/blob/docs/misc/READMORE.md">µWebSockets v0.17 user manual</a></p>
<h2 id="example">示例<a class="headerlink" href="#example" title="Permanent link"></a></h2>
<p><code>uws_test.cpp</code> 内容如下:</p>
<pre><code class="language-cpp">#include &lt;App.h&gt;

int main() {
  struct PerSocketData {
    std::string_view sec_websocket_key;
  };

  uWS::App().get(&quot;/hello&quot;, [](auto *res, auto *req) {
    res-&gt;end(&quot;Hello world!&quot;);
  }).get(&quot;/world&quot;, [](auto *res, auto *req) {
    res-&gt;writeHeader(&quot;Content-Type&quot;, &quot;text/html; charset=utf-8&quot;)-&gt;end(&quot;Hello HTTP!&quot;);
  }).ws&lt;PerSocketData&gt;(&quot;/websocket&quot;, {
    .compression = uWS::SHARED_COMPRESSOR,
    .maxPayloadLength = 16 * 1024,
    .idleTimeout = 10,
    .maxBackpressure = 1 * 1024 * 1204,
    .open = [](auto *ws, auto *req) {
      assert(ws);
      PerSocketData *perSocketData = (PerSocketData *) ws-&gt;getUserData();
      if (ws) {
        std::cout &lt;&lt; &quot;open connect by &quot;;
        // std::cout &lt;&lt; ws-&gt;getRemoteAddress();
        std::string_view addr = ws-&gt;getRemoteAddress();
        // std::cout &lt;&lt; addr &lt;&lt; &quot; &quot; &lt;&lt; addr.length();
        unsigned char *b = (unsigned char *)addr.data();
        std::cout &lt;&lt; (unsigned)b[12]
          &lt;&lt; &quot;.&quot; &lt;&lt; (unsigned)b[13]
          &lt;&lt; &quot;.&quot; &lt;&lt; (unsigned)b[14]
          &lt;&lt; &quot;.&quot; &lt;&lt; (unsigned)b[15]
          &lt;&lt; std::endl;
      }
      if (req) {
        std::cout &lt;&lt; &quot;HttpRequest Url: &quot; &lt;&lt; req-&gt;getUrl() &lt;&lt; std::endl;
        std::cout &lt;&lt; &quot;HttpRequest Method: &quot; &lt;&lt; req-&gt;getMethod() &lt;&lt; std::endl;
        std::cout &lt;&lt; &quot;HttpRequest Query: &quot; &lt;&lt; req-&gt;getQuery() &lt;&lt; std::endl;
        for (auto iter = req-&gt;begin(); iter != req-&gt;end(); ++iter) {
          std::cout &lt;&lt; &quot;HttpRequest header {&quot; &lt;&lt; iter.ptr-&gt;key &lt;&lt; &quot;, &quot; &lt;&lt; iter.ptr-&gt;value &lt;&lt; &quot;}&quot; &lt;&lt; std::endl;
          if (iter.ptr-&gt;key.compare(&quot;sec-websocket-key&quot;) == 0)
            //perSocketData-&gt;sec_websocket_key = std::string(iter.ptr-&gt;value.data(), iter.ptr-&gt;value.size());
            perSocketData-&gt;sec_websocket_key = iter.ptr-&gt;value;
        }
      }
    },
    .message = [](auto *ws, std::string_view message, uWS::OpCode opCode) {
      PerSocketData *perSocketData = (PerSocketData *) ws-&gt;getUserData();
      std::cout &lt;&lt; &quot;message from &quot; &lt;&lt; perSocketData-&gt;sec_websocket_key &lt;&lt; &quot; : &quot; &lt;&lt; message &lt;&lt; std::endl;
    },
    .drain = [](auto *ws) {
      std::cout &lt;&lt; &quot;drain&quot; &lt;&lt; std::endl;
    },
    .ping = [](auto *ws) {
      PerSocketData *perSocketData = (PerSocketData *) ws-&gt;getUserData();
      std::cout &lt;&lt; &quot;ping &quot; &lt;&lt; perSocketData-&gt;sec_websocket_key &lt;&lt; std::endl;
    },
    .pong = [](auto *ws) {
      PerSocketData *perSocketData = (PerSocketData *) ws-&gt;getUserData();
      std::cout &lt;&lt; &quot;pong &quot; &lt;&lt; perSocketData-&gt;sec_websocket_key &lt;&lt; std::endl;
    },
    .close = [](auto *ws, int code, std::string_view message) {
      PerSocketData *perSocketData = (PerSocketData *) ws-&gt;getUserData();
      std::cout &lt;&lt; &quot;disconnected with &quot; &lt;&lt; perSocketData-&gt;sec_websocket_key &lt;&lt; &quot; code: &quot; &lt;&lt; code &lt;&lt; &quot; ,message: &quot; &lt;&lt; message &lt;&lt; std::endl;
    }
  }).listen(9001, [](auto *token) {
    if (token) {
      std::cout &lt;&lt; &quot;Listening on port &quot; &lt;&lt; 9001 &lt;&lt; std::endl;
    } else {
      std::cout &lt;&lt; &quot;Failed to listen on port 9001&quot; &lt;&lt; std::endl;
    }
  }).run();
}
</code></pre>
<p>Makefile:</p>
<pre><code class="language-makefile">UWEBSOCKETS_DIR = /home/dbtu/code/uWebSockets
USOCKETS_DIR = $(UWEBSOCKETS_DIR)/uSockets

override CXXFLAGS += -flto -O3 -lpthread -Wconversion -std=c++17 -I $(UWEBSOCKETS_DIR)/src -I $(USOCKETS_DIR)/src
override LDFLAGS += $(USOCKETS_DIR)/*.o -lz
# override LDFLAGS += -L /usr/local/lib -lwolfssl
# override LDFLAGS += -luv

all: uws_test
uws_test: uws_test.cpp
clean:
        -@rm -f uws_test
</code></pre>
<h2 id="references">参考资料<a class="headerlink" href="#references" title="Permanent link"></a></h2>
<p>https://github.com/uNetworking/uWebSockets</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2022 Jerry, All Rights Reserved.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js"></script>
        <script src="../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
