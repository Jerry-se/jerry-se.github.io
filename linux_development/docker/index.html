<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Jerry">
        <link rel="canonical" href="https://jerry-se.github.io/linux_development/docker/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>docker - Jerry's blog</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../../css/extra.css" rel="stylesheet">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/django.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-274394082"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-274394082');
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Jerry's blog</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../markdown/" class="nav-link">Markdown</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">C/C++ <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../cplusplus/lambda/" class="dropdown-item">Lambda</a>
</li>
                                    
<li>
    <a href="../../cplusplus/questions/" class="dropdown-item">Questions</a>
</li>
                                    
<li>
    <a href="../../cplusplus/bit_xor/" class="dropdown-item">Bit Xor</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Go <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../go/go/" class="dropdown-item">Go tutorial</a>
</li>
                                    
<li>
    <a href="../../go/install/" class="dropdown-item">Install</a>
</li>
                                    
<li>
    <a href="../../go/getting_started/" class="dropdown-item">Getting started</a>
</li>
                                    
<li>
    <a href="../../go/create_module/" class="dropdown-item">Create module</a>
</li>
                                    
<li>
    <a href="../../go/workspaces/" class="dropdown-item">Workspaces</a>
</li>
                                    
<li>
    <a href="../../go/web_service_gin/" class="dropdown-item">Web service gin</a>
</li>
                                    
<li>
    <a href="../../go/generics/" class="dropdown-item">Generics</a>
</li>
                                    
<li>
    <a href="../../go/writing_web_app/" class="dropdown-item">Writing Web app</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Tool <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../git/git/" class="dropdown-item">Git</a>
</li>
                                    
<li>
    <a href="../../git/git_lfs/" class="dropdown-item">Git LFS</a>
</li>
                                    
<li>
    <a href="../../git/gitea/" class="dropdown-item">Gitea</a>
</li>
                                    
<li>
    <a href="../../tool/frp/" class="dropdown-item">Frp</a>
</li>
                                    
<li>
    <a href="../../tool/v2ray/" class="dropdown-item">V2Ray</a>
</li>
                                    
<li>
    <a href="../../tool/activation_keys/" class="dropdown-item">Activation</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Python <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../python/build_blogs_with_pelican/" class="dropdown-item">Pelican</a>
</li>
                                    
<li>
    <a href="../../python/mkdocs/" class="dropdown-item">MkDocs</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Linux 开发 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active">docker</a>
</li>
                                    
<li>
    <a href="../coredump/" class="dropdown-item">coredump</a>
</li>
                                    
<li>
    <a href="../ipmi/" class="dropdown-item">ipmi</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Windows 开发 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../windows_development/character_encoding/" class="dropdown-item">字符编码</a>
</li>
                                    
<li>
    <a href="../../windows_development/autostart/" class="dropdown-item">开机启动</a>
</li>
                                    
<li>
    <a href="../../windows_development/automatic_power_up/" class="dropdown-item">自动开机</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../sitemap/" class="nav-link">Index</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../python/mkdocs/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../coredump/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#docker" class="nav-link">Docker</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#install" class="nav-link">安装</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#container-usage" class="nav-link">容器使用</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#docker-run" class="nav-link">启动容器</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-ps" class="nav-link">查询容器</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-stats" class="nav-link">容器统计数据</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-start" class="nav-link">启动已停止的容器</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-stop" class="nav-link">停止容器</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-restart" class="nav-link">重启容器</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-attach" class="nav-link">连接容器</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-import-and-export" class="nav-link">导入导出容器</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-rm" class="nav-link">删除容器</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-copy" class="nav-link">拷贝文件</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#image-usage" class="nav-link">镜像使用</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="3"><a href="#docker-images" class="nav-link">列出所有镜像</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-search" class="nav-link">查找镜像</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-pull" class="nav-link">拉取镜像</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-push" class="nav-link">推送镜像</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-rmi" class="nav-link">删除镜像</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="3"><a href="#docker-commit" class="nav-link">使用容器创建一个新镜像</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#upload2aliyun" class="nav-link">制作镜像并上传到阿里云</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#references" class="nav-link">参考资料</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="docker">Docker<a class="headerlink" href="#docker" title="Permanent link"></a></h1>
<hr />
<p>Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从 Apache2.0 协议开源。</p>
<p>Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</p>
<p>容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。</p>
<h2 id="install">安装<a class="headerlink" href="#install" title="Permanent link"></a></h2>
<p>Ubuntu 18.04 安装 Docker, 使用官方安装脚本自动安装</p>
<pre><code class="language-shell">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun
</code></pre>
<p>也可以使用国内 daocloud 一键安装命令：</p>
<pre><code class="language-shell">curl -sSL https://get.daocloud.io/docker | sh
</code></pre>
<h2 id="container-usage">容器使用<a class="headerlink" href="#container-usage" title="Permanent link"></a></h2>
<p>可以通过命令 docker command --help 更深入的了解指定的 Docker 命令使用方法</p>
<h3 id="docker-run">启动容器<a class="headerlink" href="#docker-run" title="Permanent link"></a></h3>
<pre><code class="language-shell">$ docker run [OPTIONS] IMAGE [COMMAND] [ARG...]
# 使用docker镜像nginx:latest以后台模式启动一个容器,并将容器命名为mynginx。
$ docker run --name mynginx -d nginx:latest
# 使用镜像 nginx:latest，以后台模式启动一个容器,将容器的 80 端口映射到主机的 80 端口,主机的目录 /data 映射到容器的 /data。
$ docker run -p 80:80 -v /data:/data -d nginx:latest
# 绑定容器的 8080 端口，并将其映射到本地主机 127.0.0.1 的 80 端口上。
$ docker run -p 127.0.0.1:80:8080/tcp ubuntu bash
# 使用镜像nginx:latest以交互模式启动一个容器,在容器内执行/bin/bash命令。
$ docker run -it nginx:latest /bin/bash
# 在启动容器时映射一个卷到容器中:
$ sudo docker run -it --rm -v ~/DBC-AIComputingNet:/home/deepbrainchain jerry/ubuntu:dbc-compile /bin/bash
将宿主机的~/DBC-AIComputingNet映射到容器中/home/deepbrainchain
在Docker容器退出时，默认容器内部的文件系统仍然被保留，以方便调试并保留用户数据。
但是，对于foreground容器，由于其只是在开发调试过程中短期运行，其用户数据并无保留的必要，因而可以在容器启动时设置--rm选项，这样在容器退出时就能够自动清理容器内部的文件系统。
执行docker run命令带--rm命令选项，等价于在容器退出后，执行docker rm -v。
</code></pre>
<h3 id="docker-ps">查询容器<a class="headerlink" href="#docker-ps" title="Permanent link"></a></h3>
<pre><code class="language-shell">$ docker ps
$ docker ps -a
# 查询某个容器的端口映射
$ docker port &lt;CONTAINER ID&gt;
</code></pre>
<h3 id="docker-stats">容器统计数据<a class="headerlink" href="#docker-stats" title="Permanent link"></a></h3>
<pre><code class="language-shell">docker stats [OPTIONS] [CONTAINER...]
OPTIONS 说明：
  --all , -a :显示所有的容器，包括未运行的。
  --format :指定返回值的模板文件。
  --no-stream :展示当前状态就直接退出了，不再实时更新。
  --no-trunc :不截断输出。
# 列出所有在运行的容器信息。
$ docker stats
CONTAINER ID        NAME                                    CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS
b95a83497c91        awesome_brattain                        0.28%               5.629MiB / 1.952GiB   0.28%               916B / 0B           147kB / 0B          9
67b2525d8ad1        foobar                                  0.00%               1.727MiB / 1.952GiB   0.09%               2.48kB / 0B         4.11MB / 0B         2
e5c383697914        test-1951.1.kay7x1lh1twk9c0oig50sd5tr   0.00%               196KiB / 1.952GiB     0.01%               71.2kB / 0B         770kB / 0B          1
4bda148efbc0        random.1.vnc8on831idyr42slu578u3cr      0.00%               1.672MiB / 1.952GiB   0.08%               110kB / 0B          578kB / 0B          2
# 根据容器等 ID 或名称显示信息
$ docker stats awesome_brattain 67b2525d8ad1
CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS
b95a83497c91        awesome_brattain    0.28%               5.629MiB / 1.952GiB   0.28%               916B / 0B           147kB / 0B          9
67b2525d8ad1        foobar              0.00%               1.727MiB / 1.952GiB   0.09%               2.48kB / 0B         4.11MB / 0B         2
# 以 JSON 格式输出：
$ docker stats nginx --no-stream --format &quot;{{ json . }}&quot;
  {&quot;BlockIO&quot;:&quot;0B / 13.3kB&quot;,&quot;CPUPerc&quot;:&quot;0.03%&quot;,&quot;Container&quot;:&quot;nginx&quot;,&quot;ID&quot;:&quot;ed37317fbf42&quot;,&quot;MemPerc&quot;:&quot;0.24%&quot;,&quot;MemUsage&quot;:&quot;2.352MiB / 982.5MiB&quot;,&quot;Name&quot;:&quot;nginx&quot;,&quot;NetIO&quot;:&quot;539kB / 606kB&quot;,&quot;PIDs&quot;:&quot;2&quot;}
</code></pre>
<h3 id="docker-start">启动已停止的容器<a class="headerlink" href="#docker-start" title="Permanent link"></a></h3>
<pre><code class="language-shell">$ docker start &lt;CONTAINER ID&gt;
</code></pre>
<h3 id="docker-stop">停止容器<a class="headerlink" href="#docker-stop" title="Permanent link"></a></h3>
<pre><code class="language-shell">$ docker stop &lt;CONTAINER ID&gt;
</code></pre>
<h3 id="docker-restart">重启容器<a class="headerlink" href="#docker-restart" title="Permanent link"></a></h3>
<pre><code class="language-shell">$ docker restart &lt;CONTAINER ID&gt;
</code></pre>
<h3 id="docker-attach">连接容器<a class="headerlink" href="#docker-attach" title="Permanent link"></a></h3>
<p>在使用 -d 参数时，容器启动后会进入后台。此时想要进入容器，可以通过以下指令进入：</p>
<ul>
<li>docker attach: 使用此命令进入容器，再次退出时会停止容器。</li>
<li>docker exec: 推荐大家使用 docker exec 命令，因为此命令会退出容器终端，但不会导致容器的停止。</li>
</ul>
<pre><code class="language-shell">$ docker attach &lt;CONTAINER ID&gt;
$ docker exec &lt;CONTAINER ID&gt;
</code></pre>
<h3 id="docker-import-and-export">导入导出容器<a class="headerlink" href="#docker-import-and-export" title="Permanent link"></a></h3>
<pre><code class="language-shell"># 导出容器 1e560fca3906 (使用 docker ps 查询) 快照到本地文件 ubuntu.tar
$ docker export 1e560fca3906 &gt; ./ubuntu.tar
# 使用 docker import 将容器快照文件 ubuntu.tar 导入为镜像 test/ubuntu:v1
$ cat ./ubuntu.tar | docker import - test/ubuntu:v1
# 此外，也可以通过指定 URL 或者某个目录来导入
$ docker import http://example.com/exampleimage.tgz example/imagerepo
$ docker images
</code></pre>
<h3 id="docker-rm">删除容器<a class="headerlink" href="#docker-rm" title="Permanent link"></a></h3>
<pre><code class="language-shell">$ docker rm &lt;CONTAINER ID&gt;
$ docker rm -f &lt;CONTAINER ID&gt;
# 下面的命令可以清理掉所有处于终止状态的容器。
$ docker container prune
</code></pre>
<h3 id="docker-copy">拷贝文件<a class="headerlink" href="#docker-copy" title="Permanent link"></a></h3>
<p>在客户机和容器之间拷贝文件：</p>
<pre><code class="language-shell">$ docker cp 源文件地址 目标文件夹
$ sudo docker cp 3754e2278fa4:/home/deepbrainchain/output/dbc /home/cuijg/pack/
</code></pre>
<h2 id="image-usage">镜像使用<a class="headerlink" href="#image-usage" title="Permanent link"></a></h2>
<p>当运行容器时，使用的镜像如果在本地中不存在，docker 就会自动从 docker 镜像仓库中下载，默认是从 Docker Hub 公共镜像源下载。</p>
<h3 id="docker-images">列出所有镜像<a class="headerlink" href="#docker-images" title="Permanent link"></a></h3>
<pre><code class="language-shell">runoob@runoob:~$ docker images           
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
ubuntu              14.04               90d5884b1ee0        5 days ago          188 MB
php                 5.6                 f40e9e0f10c8        9 days ago          444.8 MB
nginx               latest              6f8d099c3adc        12 days ago         182.7 MB
mysql               5.6                 f2e8d6c772c0        3 weeks ago         324.6 MB
httpd               latest              02ef73cf1bc0        3 weeks ago         194.4 MB
ubuntu              15.10               4e3b13c8a266        4 weeks ago         136.3 MB
hello-world         latest              690ed74de00f        6 months ago        960 B
training/webapp     latest              6fae60ef3446        11 months ago       348.8 MB
</code></pre>
<p>同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本，如 ubuntu 仓库源里，有 15.10、14.04 等多个不同的版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。</p>
<p>所以，我们如果要使用版本为15.10的ubuntu系统镜像来运行容器时，命令如下：</p>
<pre><code class="language-shell">$ docker run -t -i ubuntu:15.10 /bin/bash 
</code></pre>
<blockquote>
<p>如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像。</p>
</blockquote>
<h3 id="docker-search">查找镜像<a class="headerlink" href="#docker-search" title="Permanent link"></a></h3>
<p>我们可以从 Docker Hub 网站来搜索镜像，Docker Hub 网址为： https://hub.docker.com/</p>
<p>我们也可以使用 docker search 命令来搜索镜像。比如我们需要一个 httpd 的镜像来作为我们的 web 服务。我们可以通过 docker search 命令搜索 httpd 来寻找适合我们的镜像。</p>
<pre><code class="language-shell">$ sudo docker search httpd
NAME                                 DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
httpd                                The Apache HTTP Server Project                  4331      [OK]       
clearlinux/httpd                     httpd HyperText Transfer Protocol (HTTP) ser…   2                    
avenga/httpd-static                                                                  0                    
betterweb/httpd                                                                      0                    
centos/httpd-24-centos7              Platform for running Apache httpd 2.4 or bui…   45                   
manageiq/httpd                       Container with httpd, built on CentOS for Ma…   1                    [OK]
centos/httpd-24-centos8                                                              1                    
dockerpinata/httpd                                                                   1                    
19022021/httpd-connection_test       This httpd image will test the connectivity …   0                    
paketobuildpacks/httpd                                                               0                    
centos/httpd                                                                         36                   [OK]
publici/httpd                        httpd:latest                                    1                    [OK]
</code></pre>
<h3 id="docker-pull">拉取镜像<a class="headerlink" href="#docker-pull" title="Permanent link"></a></h3>
<p>我们决定使用上图中的 httpd 官方版本的镜像，使用命令 docker pull 来下载镜像。</p>
<pre><code class="language-shell">$ docker pull httpd
Using default tag: latest
latest: Pulling from library/httpd
8b87079b7a06: Pulling fs layer 
a3ed95caeb02: Download complete 
0d62ec9c6a76: Download complete 
a329d50397b9: Download complete 
ea7c1f032b5c: Waiting 
be44112b72c7: Waiting
</code></pre>
<p>下载完成后，我们就可以使用这个镜像了。</p>
<h3 id="docker-push">推送镜像<a class="headerlink" href="#docker-push" title="Permanent link"></a></h3>
<p>将本地的镜像上传到镜像仓库,要先登陆到镜像仓库。参考下面的将镜像推送到阿里云。</p>
<h3 id="docker-rmi">删除镜像<a class="headerlink" href="#docker-rmi" title="Permanent link"></a></h3>
<p>镜像删除使用 docker rmi 命令，比如我们删除 hello-world 镜像：</p>
<pre><code class="language-shell">$ sudo docker rmi hello-world
Untagged: hello-world:latest
Untagged: hello-world@sha256:aa0cc8055b82dc2509bed2e19b275c8f463506616377219d9642221ab53cf9fe
Deleted: sha256:feb5d9fea6a5e9606aa995e879d862b825965ba48de054caab5ef356dc6b3412
Deleted: sha256:e07ee1baac5fae6a26f30cabfe54a36d3402f96afda318fe0a96cec4ca393359
</code></pre>
<p>删除正在使用的镜像会报错，优雅的删除镜像分为三步:</p>
<ol>
<li>停止使用镜像的容器 <code>docker stop [CONTAINER ID]</code>，可以通过 <code>docker ps -a</code> 查询。</li>
<li>删除容器 <code>docker rm [CONTAINER ID]</code>。</li>
<li>删除镜像 <code>docker rmi [IMAGE ID]</code>，可以通过 <code>docker images</code> 查询。</li>
</ol>
<h3 id="docker-commit">使用容器创建一个新镜像<a class="headerlink" href="#docker-commit" title="Permanent link"></a></h3>
<p>使用 docker run 启动一个容器，运行一些命令或者修改后，可以将修改后的容器保存为新的镜像，并添加提交人信息和说明信息。</p>
<pre><code class="language-shell">docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]
OPTIONS说明：
  -a :提交的镜像作者；
  -c :使用Dockerfile指令来创建镜像；
  -m :提交时的说明文字；
  -p :在commit时，将容器暂停。
# 将容器 a404c6c174a2 保存为新的镜像,并添加提交人信息和说明信息。
$ docker commit -a &quot;runoob.com&quot; -m &quot;my apache&quot; a404c6c174a2 mymysql:v1 
sha256:37af1236adef1544e8886be23010b66577647a40bc02c0885a6600b33ee28057
$ docker images mymysql:v1
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
mymysql             v1                  37af1236adef        15 seconds ago      329 MB
</code></pre>
<pre><code class="language-shell">$ sudo docker commit -m &quot;ubuntu-dev&quot; -a &quot;jerry&quot; b8b1b3da0fea jerry/ubuntu:dev
参数解释如下：
 -m: 提交的描述信息
 -a: 指定镜像作者
 1683ab3e55f0：需要保存的容器 ID，通过sudo docker ps查看第一列
 shichao/ubuntu:v1: 指定要创建的目标镜像名，冒号前面代表存储库，后面代表标记TAG
注意：保存镜像：在保存镜像前保证容器不退出
用新镜像启动一个容器
$ sudo docker run -it jerry/ubuntu:dev /bin/bash
</code></pre>
<h2 id="upload2aliyun">制作镜像并上传到阿里云<a class="headerlink" href="#upload2aliyun" title="Permanent link"></a></h2>
<p>创建阿里云账号，搜索"容器镜像服务"，进入容器镜像服务控制台。
此处需要单独设置容器镜像服务的密码: RtGc5sC9</p>
<p>选择个人实例，创建命名空间和镜像仓库。</p>
<p>还需要绑定代码仓库，此处使用阿里云的 Codeup 代码平台，生成授权第三方访问的令牌。
为需要访问 Codeup 的应用程序生成个人访问令牌(Personal Access Token): agp_3a57b771cf07bedf285aaf1665385254</p>
<pre><code class="language-shell"># local host
$ sudo docker pull ubuntu:18.04
$ sudo docker run -it ubuntu:18.04 /bin/bash
# 容器内命令
$ echo &quot;deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse&quot; &gt; /etc/apt/sources.list
$ echo &quot;deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse&quot; &gt;&gt; /etc/apt/sources.list
$ echo &quot;deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse&quot; &gt;&gt; /etc/apt/sources.list
$ echo &quot;deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse&quot; &gt;&gt; /etc/apt/sources.list
$ apt clean
$ apt update
$ apt install -y vim wget
$ wget https://apt.kitware.com/kitware-archive.sh
$ bash kitware-archive.sh
$ apt install cmake
$ apt install -y build-essential uuid-dev libssl-dev libvirt-dev
# local host
$ sudo docker ps -a
CONTAINER ID   IMAGE          COMMAND       CREATED             STATUS             PORTS     NAMES
9eceaca0f7aa   ubuntu:18.04   &quot;/bin/bash&quot;   About an hour ago   Up About an hour             gracious_curie
$ sudo docker commit -m &quot;ubuntu 18.04 for compiling dbc&quot; -a &quot;jerry&quot; 9eceaca0f7aa dbc:0.1
$ sudo docker images
REPOSITORY                                       TAG       IMAGE ID       CREATED         SIZE
dbc                                              0.1       652c9a351f80   2 minutes ago   490MB
ubuntu                                           18.04     5d2df19066ac   2 weeks ago     63.1MB
hello-world                                      latest    feb5d9fea6a5   16 months ago   13.3kB
$ sudo docker tag 652c9a351f80 registry.cn-shanghai.aliyuncs.com/jerry_se/dbc:0.1
$ sudo docker images
REPOSITORY                                       TAG       IMAGE ID       CREATED         SIZE
dbc                                              0.1       652c9a351f80   2 minutes ago   490MB
registry.cn-shanghai.aliyuncs.com/jerry_se/dbc   0.1       652c9a351f80   2 minutes ago   490MB
ubuntu                                           18.04     5d2df19066ac   2 weeks ago     63.1MB
hello-world                                      latest    feb5d9fea6a5   16 months ago   13.3kB
$ sudo docker login --username=jerry_se registry.cn-shanghai.aliyuncs.com
Password: 
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
$ sudo docker push registry.cn-shanghai.aliyuncs.com/jerry_se/dbc:0.1
The push refers to repository [registry.cn-shanghai.aliyuncs.com/jerry_se/dbc]
417e54fb9fc5: Pushed 
475a54c2a93d: Pushed 
0.1: digest: sha256:103fbc726876c7ac475ba7aa4ddc06ad45e9e5b1b238e5c771d24e2a79bdc821 size: 742

# other host
$ sudo docker login --username=jerry_se registry.cn-shanghai.aliyuncs.com
$ sudo docker pull registry.cn-shanghai.aliyuncs.com/jerry_se/dbc:0.1
</code></pre>
<pre><code>ubuntu 18.04 阿里云的更新源
deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse

# deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
# deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse

deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
</code></pre>
<h2 id="references">参考资料<a class="headerlink" href="#references" title="Permanent link"></a></h2>
<ul>
<li><a href="https://www.runoob.com/docker/docker-tutorial.html">菜鸟教程</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/113666046">实战 | ​Docker ubuntu:18.04 镜像制作</a></li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2022 Jerry, All Rights Reserved.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
